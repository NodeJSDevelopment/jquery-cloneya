(function(a){var b=function(g,o){var m=/^(.*)(\d)+$/i;var d=a(g);var e={cloneThis:".toclone",cloneButton:".clone",deleteButton:".delete",clonePosition:"after",minimum:1,maximum:999,valueClone:false,dataClone:false,deepClone:false,serializeID:true,ignore:"label.error",defaultCount:0,preserveInitialChildCount:false};if(typeof o!=="undefined"){if(typeof o.limit!=="undefined"&&o.limit>0){o.maximum=o.limit}if(typeof o.defaultRender!=="undefined"&&o.defaultRender>0){o.defaultCount=o.defaultRender}}var c=a.extend(e,o||{});this.getOption=function(){return c};this.setOption=function(p){a.extend(c,p||{})};var n=d.closestChild(c.cloneThis);var l=function(s,r){var q=r.closest(g).closestChild(c.cloneThis).length;if(q<c.maximum){d.triggerHandler("clone_before_clone",[r]);var p=h(r);d.triggerHandler("clone_after_clone",[r,p]);n.add(p);d.triggerHandler("clone_before_append",[r,p]);if(c.clonePosition!=="after"){r.before(p)}else{r.after(p)}if(c.ignore){p.find(c.ignore).remove()}f();d.triggerHandler("clone_after_append",[r,p])}else{d.triggerHandler("clone_limit",c.maximum,[r]);d.triggerHandler("clone_maximum",c.maximum,[r])}};var h=function(q){var p=q.clone({withDataAndEvents:c.dataClone,deepWithDataAndEvents:c.deepClone});if(c.preserveInitialChildCount!==false){p.find(".cloneya-wrap").each(function(){var s=a(this).closestChild(".cloneya");var r=s.data("initialCount");var t=s.slice(r,s.length);t.remove()})}p.find("input, textarea, select").each(function(){k(a(this));d.triggerHandler("clone_form_input",[a(this),q,p])});return p};d.addClass("cloneya-wrap");n.addClass("cloneya");n.data("initialCount",n.length);d.on("click",c.cloneThis+">"+c.cloneButton,function(q){q.preventDefault();q.stopPropagation();var p=a(this).closest(c.cloneThis);d.triggerHandler("clone_clone",[p])});d.on("clone_clone",function(q,p){l(q,p)});d.on("click",c.cloneThis+">"+c.deleteButton,function(q){q.preventDefault();q.stopPropagation();var p=a(this).closest(c.cloneThis);d.triggerHandler("clone_delete",[p])});d.on("clone_delete",function(r,q){var p=q.closest(g).closestChild(c.cloneThis).length;a.when(d.triggerHandler("clone_before_delete",[q,p])).done(function(){d.triggerHandler("clone_after_delete")})});d.on("clone_before_delete",function(r,q,p){if(p>c.minimum){a(q).remove()}else{d.triggerHandler("clone_minimum",c.minimum,[q]);q.find("input, textarea, select").each(function(){k(a(this))})}});var k=function(p){if(!c.valueClone&&!p.hasClass("noEmpty")){if(p.is(":checkbox")||p.is(":radio")){p.prop("checked",false)}else{p.val("")}}};var f=function(){if(c.serializeID!==true){return}var p=d.find(c.cloneThis).first().attr("id");d.find(c.cloneThis).each(function(r){if(r!==0){j=r}else{j=""}if(a(this).attr("id")){a(this).attr("id",p+j)}var s,q;a(this).find("*").each(function(){s=a(this).attr("id");if(s){var v=s.match(m);if(v&&v.length===3){q=s.replace(/\d+$/,"")+j;a(this).attr("id",q)}else{q=s+j;a(this).attr("id",q)}}a(this).closest(c.cloneThis).find("label[for='"+s+"']").attr("for",q);if(c.serializeIndex){var u=a(this).attr("name");if(u){var w=u.match(/\[([^}]+)\]/);if(w&&w.length>=1){var t=u;u=[].map.call(t,function(x,y){return(!isNaN(+x)&&t[y-1]==="["&&t[y+1]==="]")?r:x}).join("");a(this).attr("name",u)}}}})})};if(c.defaultRender){for(i=1;i<c.defaultRender;i++){a(c.cloneButton).last().trigger("click")}}};a.fn.cloneya=function(c){return this.each(function(){var d=a(this);if(d.data("cloneya")){return}var e=new b(this,c);d.data("cloneya",e)})};a.fn.closestChild=function(c){var e,d;e=this.children();if(e.length===0){return a()}d=e.filter(c);if(d.length>0){return d}else{return e.closestChild(c)}}})(jQuery);