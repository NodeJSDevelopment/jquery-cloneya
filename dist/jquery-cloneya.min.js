(function(b){var a="cloneya",d={cloneThis:".toclone",cloneButton:".clone",deleteButton:".delete",clonePosition:"after",minimum:1,maximum:999,valueClone:false,dataClone:false,deepClone:false,serializeID:true,ignore:"label.error",defaultCount:0,preserveInitialChildCount:false};function c(f,e){this.regex=/^(.*)(\d)+$/i;this.elem=f;this.$elem=b(f);if(typeof e!=="undefined"){if(typeof e.limit!=="undefined"&&e.limit>0){e.maximum=e.limit}if(typeof e.defaultRender!=="undefined"&&e.defaultRender>0){e.defaultCount=e.defaultRender}}this.config=b.extend({},d,e);this.clones=this.$elem.closestChild(this.config.cloneThis);this.init()}c.prototype={init:function(){var e=this;e.$elem.addClass(a+"-wrap");e.clones.addClass(a);e.clones.data("initialCount",e.clones.length);e.$elem.on("click."+a,e.config.cloneThis+">"+e.config.cloneButton,function(g){g.preventDefault();g.stopPropagation();var f=b(this).closest(e.config.cloneThis);e.$elem.triggerAll("clone_clone clone."+a,[f])});e.$elem.on("clone."+a,function(g,f){e._cloneAndAppend(f)});e.$elem.on("click."+a,e.config.cloneThis+">"+e.config.deleteButton,function(g){g.preventDefault();g.stopPropagation();var f=b(this).closest(e.config.cloneThis);e.$elem.triggerAll("clone_delete delete."+a,[f])});e.$elem.on("delete."+a,function(h,g){var f=g.closest(e.elem).closestChild(e.config.cloneThis).length;b.when(e.$elem.triggerAll("clone_before_delete before_delete."+a,[g,f])).done(function(){e.$elem.triggerAll("clone_after_delete after_delete."+a)})});e.$elem.on("before_delete."+a,function(h,g,f){if(f>e.config.minimum){b(g).remove()}else{e.$elem.triggerHandler("minimum."+a,e.config.minimum,[g]);g.find("input, textarea, select").each(function(){e._clearForm(b(this))})}});this._defaultRender()},_clean:function(){var e=this;e.$elem.removeClass(a+"-wrap");e.clones.removeClass(a);e.$elem.off("click."+a,e.config.cloneThis+">"+e.config.cloneButton);e.$elem.off("click."+a,e.config.cloneThis+">"+e.config.deleteButton);e.$elem.off("clone_clone clone_delete clone_before_delete clone."+a+" delete."+a+" before_delete."+a)},destroy:function(){this._clean();this.$elem.removeData(a)},getOption:function(){return this.config},setOption:function(e){b.extend(this.config,e||{});this._clean();this.init()},_cloneAndAppend:function(g){var f=g.closest(this.elem).closestChild(this.config.cloneThis).length;if(f<this.config.maximum){this.$elem.triggerAll("clone_before_clone before_clone."+a,[g]);var e=this._cloneItem(g);this.$elem.triggerAll("clone_after_clone after_clone."+a,[g,e]);this.clones.add(e);this.$elem.triggerAll("clone_before_append before_append."+a,[g,e]);if(this.config.clonePosition!=="after"){g.before(e)}else{g.after(e)}if(this.config.ignore){e.find(this.config.ignore).remove()}this._redoIDs();this.$elem.triggerAll("clone_after_append after_append."+a,[g,e])}else{this.$elem.triggerAll("clone_limit maximum."+a,this.config.maximum,[g])}},_cloneItem:function(f){var g=this;var e=f.clone({withDataAndEvents:g.config.dataClone,deepWithDataAndEvents:g.config.deepClone});if(g.config.preserveInitialChildCount!==false){e.find("."+a+"-wrap").each(function(){var i=b(this).closestChild("."+a);var h=i.data("initialCount");var j=i.slice(h,i.length);j.remove()})}e.find("input, textarea, select").each(function(){g._clearForm(b(this));g.$elem.triggerHandler("clone_form_input",[b(this),f,e])});return e},_clearForm:function(e){if(!this.config.valueClone&&!e.hasClass("noEmpty")){if(e.is(":checkbox")||e.is(":radio")){e.prop("checked",false)}else{e.val("")}}},_redoIDs:function(){var f=this;if(f.config.serializeID!==true){return}var e=f.$elem.find(f.config.cloneThis).first().attr("id");f.$elem.find(f.config.cloneThis).each(function(k){var h;if(k!==0){h=k}else{h=""}if(b(this).attr("id")){b(this).attr("id",e+h)}var l,g;b(this).find("*").each(function(){l=b(this).attr("id");if(l){var m=l.match(f.regex);if(m&&m.length===3){g=l.replace(/\d+$/,"")+h;b(this).attr("id",g)}else{g=l+h;b(this).attr("id",g)}}b(this).closest(f.config.cloneThis).find("label[for='"+l+"']").attr("for",g);if(f.config.serializeIndex){var j=b(this).attr("name");if(j){var n=j.match(/\[([^}]+)\]/);if(n&&n.length>=1){var i=j;j=[].map.call(i,function(o,p){return(!isNaN(+o)&&i[p-1]==="["&&i[p+1]==="]")?k:o}).join("");b(this).attr("name",j)}}}})})},_defaultRender:function(){var h=this;if(h.config.defaultCount){var f=h.clones.length;if(f<h.config.defaultCount){var e=h.config.defaultCount-f;for(var g=1;g<=e;g++){h._cloneAndAppend(h.clones.last())}}}}};b.fn[a]=function(g){var f=arguments;if(g===undefined||typeof g==="object"){return this.each(function(){if(!b.data(this,a)){b.data(this,a,new c(this,g))}})}else{if(typeof g==="string"&&g[0]!=="_"&&g!=="init"){if(Array.prototype.slice.call(f,1).length===0&&b.inArray(g,b.fn[a].getters)!==-1){var e=b.data(this[0],a);return e[g].apply(e,Array.prototype.slice.call(f,1))}else{return this.each(function(){var h=b.data(this,a);if(h instanceof c&&typeof h[g]==="function"){h[g].apply(h,Array.prototype.slice.call(f,1))}})}}}};b.fn[a].getters=["getOption"];b.fn.closestChild=function(e){var g,f;g=this.children();if(g.length===0){return b()}f=g.filter(e);if(f.length>0){return f}else{return g.closestChild(e)}};b.fn.extend({triggerAll:function(g,j){var h=this,f,e=g.split(" ");for(f=0;f<e.length;f+=1){h.triggerHandler(e[f],j)}return h}})})(jQuery);