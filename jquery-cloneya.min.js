(function(a){var b=function(){};var c=function(c,d){var e=/^(.*)(\d)+$/i;var f=/\[.*(\d+)\]/;var g=a(c);var h=this;var i={maxLimit:999,toClone:"toclone",baseID:"",valueClone:false,dataClone:false,deepClone:false,cloneButton:"clone",removeButton:"remove",clonePosition:"after",beforeClone:b,afterClone:b,beforeAppend:b,afterAppend:b,beforeRemove:b,afterRemove:b,maxLimitReach:b,indexadjust:true};var k=a.extend(i,d||{});this.getConfig=function(){return k};var l=g.find("."+k.toClone);if(!k.baseID){mainid=k.baseID}else{mainid=l.first().attr("id")}mainid=l.first().attr("id");maininex=l.first().attr("name");var m=l.length;g.on("click","."+k.cloneButton,function(b){b.preventDefault();if(m<k.maxLimit){$toclone=a(this).closest("."+k.toClone);k.beforeClone($toclone);$newclone=$toclone.clone({withDataAndEvents:k.dataClone,deepWithDataAndEvents:k.deepClone});$newclone.find("input, textarea, select").each(function(){if(!k.valueClone){a(this).val("")}var b=a(this).attr("name");if(b){var c=b.match(f);if(c&&c.length==2){newindex="[]";newname=b.replace(/\[.*(\d+)\]/,newindex);a(this).attr("name",newname)}}});currIndex=m+1;k.afterClone($toclone,$newclone);k.beforeAppend($toclone,$newclone);if(k.clonePosition!="after"){$toclone.before($newclone)}else{$toclone.after($newclone)}n();k.afterAppend($toclone,$newclone);m++}else{k.maxLimitReach(k.maxLimit)}});g.on("click","."+k.removeButton,function(b){b.preventDefault();if(m>1){$toremove=a(this).closest("."+k.toClone);k.beforeRemove($toremove);$toremove.remove();k.afterRemove($toremove);m--}});var n=function(){a("."+k.toClone).each(function(b){if(b!=0){j=b}else{j=""}if(a(this).attr("id")){a(this).attr("id",mainid+j)}a(this).find("*").each(function(){var b=a(this).attr("id");if(b){var c=b.match(e);if(c&&c.length==3){a(this).attr("id",c[1]+j)}else{a(this).attr("id",b+j)}}})})}};a.fn.cloneya=function(b){return this.each(function(){var d=a(this);if(d.data("cloneya"))return;var e=new c(this,b);d.data("cloneya",e)})}})(jQuery)
